chrome.runtime.onMessage.addListener((e,t,a)=>("runJql"===e.action?(runJqlQuery(e.jql).then(e=>a({tickets:e})).catch(e=>a({error:e.message})),!0):"addComments"===e.action&&(addCommentsToTickets(e.tickets,e.comment).then(e=>a(e)).catch(e=>a({error:e.message})),!0)));async function runJqlQuery(e){try{const t=window.location.origin,a=await fetch(`${t}/rest/api/2/search`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({jql:e,maxResults:100,fields:["summary","status","assignee","updated","created","duedate","description"]})});if(!a.ok)throw new Error(`Jira API error: ${a.status}`);return(await a.json()).issues.map(e=>({key:e.key,summary:e.fields.summary,status:e.fields.status?.name,assignee:e.fields.assignee?.displayName||"Unassigned",updated:e.fields.updated,duedate:e.fields.duedate}))}catch(e){throw console.error("JQL Query Error:",e),e}}async function addCommentsToTickets(e,t){const a=window.location.origin;let s=0,r=0;for(const n of e){try{(await fetch(`${a}/rest/api/2/issue/${n.key}/comment`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({body:t})})).ok?(s++,console.log(`✓ Added comment to ${n.key}`)):(r++,console.error(`✗ Failed to add comment to ${n.key}`))}catch(e){r++,console.error(`✗ Error on ${n.key}:`,e)}await new Promise(e=>setTimeout(e,500))}return{success:s,errors:r,message:`Added comment to ${s} ticket(s). ${r} error(s).`}}console.log("Jira Hygiene Assistant content script loaded");